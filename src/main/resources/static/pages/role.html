<link rel="stylesheet" href="/ems/css/role.css">

<div class="main-content">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="page-header" v-if="!pageError">
        <h1 class="page-title">è§’è‰²ç®¡ç†</h1>
        <p class="page-subtitle">ç®¡ç†ç³»ç»Ÿè§’è‰²ï¼ŒåŒ…æ‹¬è§’è‰²æ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤ä»¥åŠæƒé™é…ç½®</p>
    </div>

    <!-- æœç´¢å’Œæ“ä½œæ  -->
    <div class="toolbar">
        <div class="search-box">
            <input
                v-model="queryForm.roleName"
                type="text"
                class="search-input"
                placeholder="è¾“å…¥è§’è‰²åç§°æœç´¢"
            >
            <input
                v-model="queryForm.roleCode"
                type="text"
                class="search-input"
                placeholder="è¾“å…¥è§’è‰²ç¼–ç æœç´¢"
            >
            <select v-model="queryForm.status" class="search-select">
                <option :value="null">å…¨éƒ¨çŠ¶æ€</option>
                <option :value="1">æ­£å¸¸</option>
                <option :value="0">ç¦ç”¨</option>
            </select>
            <button class="btn btn-primary" @click="handleSearch">
                <span>ğŸ”</span>
                <span>æœç´¢</span>
            </button>
            <button class="btn btn-secondary" @click="handleReset">
                <span>â†º</span>
                <span>é‡ç½®</span>
            </button>
        </div>
        <button class="btn btn-success" @click="openAddModal">
            <span>+</span>
            <span>æ–°å¢è§’è‰²</span>
        </button>
    </div>

    <!-- è§’è‰²åˆ—è¡¨ -->
    <div class="table-container">
        <div v-if="loading" class="loading">
            <div class="loading-spinner"></div>
            <p>åŠ è½½ä¸­...</p>
        </div>
        <table v-else class="role-table">
            <thead>
                <tr>
                    <th>åºå·</th>
                    <th>è§’è‰²åç§°</th>
                    <th>è§’è‰²ç¼–ç </th>
                    <th>çŠ¶æ€</th>
                    <th>åˆ›å»ºæ—¶é—´</th>
                    <th>æ›´æ–°æ—¶é—´</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                <tr v-if="roleList.length === 0">
                    <td colspan="7" class="empty-cell">
                        <div class="empty-content">
                            <div class="empty-icon">ğŸ“­</div>
                            <p>æš‚æ— æ•°æ®</p>
                        </div>
                    </td>
                </tr>
                <tr v-for="(role, index) in roleList" :key="role.id">
                    <td>{{ (pagination.current - 1) * pagination.size + index + 1 }}</td>
                    <td>{{ role.roleName }}</td>
                    <td>{{ role.roleCode }}</td>
                    <td>
                        <span class="status-badge" :class="getStatusClass(role.status)">
                            {{ getStatusText(role.status) }}
                        </span>
                    </td>
                    <td>{{ formatDateTime(role.createTime) }}</td>
                    <td>{{ formatDateTime(role.updateTime) }}</td>
                    <td class="actions">
                        <button class="action-btn btn-edit" @click="openEditModal(role)">
                            <span>âœï¸</span>
                            ç¼–è¾‘
                        </button>
                        <button class="action-btn btn-assign" @click="openAssignModal(role)">
                            <span>ğŸ”</span>
                            åˆ†é…æƒé™
                        </button>
                        <button class="action-btn btn-delete" @click="handleDelete(role)">
                            <span>ğŸ—‘ï¸</span>
                            åˆ é™¤
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- åˆ†é¡µ -->
    <div class="pagination" v-if="roleList.length > 0">
        <button
            class="pagination-btn"
            :disabled="pagination.current === 1"
            @click="handlePageChange(pagination.current - 1)"
        >
            ä¸Šä¸€é¡µ
        </button>
        <span class="pagination-info">
            ç¬¬ {{ pagination.current }} / {{ pagination.pages }} é¡µ
            <span class="pagination-total">å…± {{ pagination.total }} æ¡è®°å½•</span>
        </span>
        <button
            class="pagination-btn"
            :disabled="pagination.current >= pagination.pages"
            @click="handlePageChange(pagination.current + 1)"
        >
            ä¸‹ä¸€é¡µ
        </button>
    </div>

    <!-- è§’è‰²ç¼–è¾‘å¼¹çª— -->
    <div class="modal-overlay" v-show="showRoleModal" @click.self="closeRoleModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>{{ roleModalMode === 'add' ? 'æ–°å¢è§’è‰²' : 'ç¼–è¾‘è§’è‰²' }}</h2>
                <button class="modal-close" @click="closeRoleModal">âœ•</button>
            </div>
            <div class="modal-body">
                <form @submit.prevent="handleRoleSubmit">
                    <div class="form-group">
                        <label class="form-label">è§’è‰²åç§° <span class="required">*</span></label>
                        <input
                            v-model="roleForm.roleName"
                            type="text"
                            class="form-input"
                            placeholder="è¯·è¾“å…¥è§’è‰²åç§°"
                        >
                    </div>
                    <div class="form-group">
                        <label class="form-label">è§’è‰²ç¼–ç  <span class="required">*</span></label>
                        <input
                            v-model="roleForm.roleCode"
                            type="text"
                            class="form-input"
                            placeholder="è¯·è¾“å…¥è§’è‰²ç¼–ç "
                            :disabled="roleModalMode === 'edit'"
                        >
                    </div>
                    <div class="form-group" v-if="roleModalMode === 'edit'">
                        <label class="form-label">çŠ¶æ€</label>
                        <select v-model="roleForm.status" class="form-input">
                            <option :value="1">æ­£å¸¸</option>
                            <option :value="0">ç¦ç”¨</option>
                        </select>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" @click="closeRoleModal">
                            å–æ¶ˆ
                        </button>
                        <button type="submit" class="btn btn-primary">
                            ç¡®å®š
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- èœå•åˆ†é…å¼¹çª— -->
    <div class="modal-overlay" v-show="showAssignModal" @click.self="closeAssignModal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>åˆ†é…æƒé™ - {{ currentRole?.roleName }}</h2>
                <button class="modal-close" @click="closeAssignModal">âœ•</button>
            </div>
            <div class="modal-body">
                <div v-if="menuLoading" class="loading">
                    <div class="loading-spinner"></div>
                    <p>åŠ è½½èœå•ä¸­...</p>
                </div>
                <div v-else class="menu-tree-container">
                    <div class="menu-tree-header">
                        <label class="checkbox-label">
                            <input type="checkbox" v-model="selectAll" @change="handleSelectAll">
                            <span>å…¨é€‰</span>
                        </label>
                    </div>
                    <div class="menu-tree-content">
                        <div v-for="menu in menuTree" :key="menu.id" class="menu-item">
                            <div class="menu-row">
                                <label class="checkbox-label">
                                    <input
                                        type="checkbox"
                                        :value="menu.id"
                                        v-model="selectedMenuIds"
                                        @change="handleParentChange(menu)"
                                    >
                                    <span class="menu-icon">{{ menu.menuType === 'D' ? 'ğŸ“' : 'ğŸ“„' }}</span>
                                    <span class="menu-name">{{ menu.menuName }}</span>
                                </label>
                            </div>
                            <div v-if="menu.children && menu.children.length > 0" class="menu-children">
                                <div v-for="child in menu.children" :key="child.id" class="menu-item menu-child">
                                    <div class="menu-row">
                                        <label class="checkbox-label">
                                            <input
                                                type="checkbox"
                                                :value="child.id"
                                                v-model="selectedMenuIds"
                                            >
                                            <span class="menu-icon">{{ child.menuType === 'D' ? 'ğŸ“' : 'ğŸ“„' }}</span>
                                            <span class="menu-name">{{ child.menuName }}</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" @click="closeAssignModal">
                        å–æ¶ˆ
                    </button>
                    <button type="button" class="btn btn-primary" @click="handleAssignSubmit">
                        ä¿å­˜
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/ems/js/role.js"></script>
