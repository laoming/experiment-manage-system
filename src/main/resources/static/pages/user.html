<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂÆûÈ™åÁÆ°ÁêÜÁ≥ªÁªü - Áî®Êà∑ÁÆ°ÁêÜ</title>
    <link rel="stylesheet" href="/ems/css/common.css">
    <link rel="stylesheet" href="/ems/css/user.css">
    <!-- ËØ∑Ê±ÇÊã¶Êà™Âô® - ÂøÖÈ°ªÂú®ÂÖ∂‰ªñJS‰πãÂâçÂä†ËΩΩ -->
    <script src="/ems/js/request.js"></script>
    <script src="/ems/js/auth.js"></script>
</head>
<body>
    <div id="app">
        <!-- È°∂ÈÉ®ÂØºËà™Ê†èÁªÑ‰ª∂ -->
        <header-component @open-profile="openUserProfileModal"></header-component>

        <!-- ‰∏ªÂÜÖÂÆπÂå∫Âüü -->
        <div class="main-content">
            <div class="container">
                <!-- È°µÈù¢Ê†áÈ¢ò -->
                <div class="page-header">
                    <h1 class="page-title">Áî®Êà∑ÁÆ°ÁêÜ</h1>
                    <p class="page-subtitle">ÁÆ°ÁêÜÁ≥ªÁªüÁî®Êà∑ÔºåÂåÖÊã¨Áî®Êà∑Ê∑ªÂä†„ÄÅÁºñËæë„ÄÅÂà†Èô§‰ª•ÂèäÂØÜÁ†ÅÈáçÁΩÆ</p>
                </div>

                <!-- ÊêúÁ¥¢ÂíåÊìç‰ΩúÊ†è -->
                <div class="toolbar">
                    <div class="search-box">
                        <input
                            v-model="queryForm.username"
                            type="text"
                            class="search-input"
                            placeholder="ËæìÂÖ•Ë¥¶Âè∑ÊêúÁ¥¢"
                        >
                        <input
                            v-model="queryForm.displayName"
                            type="text"
                            class="search-input"
                            placeholder="ËæìÂÖ•Áî®Êà∑ÂêçÁß∞ÊêúÁ¥¢"
                        >
                        <select v-model="queryForm.roleId" class="search-select">
                            <option :value="null">ÂÖ®ÈÉ®ËßíËâ≤</option>
                            <option v-for="role in roleList" :key="role.id" :value="role.id">
                                {{ role.roleName }}
                            </option>
                        </select>
                        <select v-model="queryForm.status" class="search-select">
                            <option :value="null">ÂÖ®ÈÉ®Áä∂ÊÄÅ</option>
                            <option :value="1">ÊøÄÊ¥ª</option>
                            <option :value="2">Á¶ÅÁî®</option>
                        </select>
                        <button class="btn btn-primary" @click="handleSearch">
                            <span>üîç</span>
                            <span>ÊêúÁ¥¢</span>
                        </button>
                        <button class="btn btn-secondary" @click="handleReset">
                            <span>‚Ü∫</span>
                            <span>ÈáçÁΩÆ</span>
                        </button>
                    </div>
                    <button class="btn btn-success" @click="openAddModal">
                        <span>+</span>
                        <span>Êñ∞Â¢ûÁî®Êà∑</span>
                    </button>
                </div>

                <!-- Áî®Êà∑ÂàóË°® -->
                <div class="table-container">
                    <div v-if="loading" class="loading">
                        <div class="loading-spinner"></div>
                        <p>Âä†ËΩΩ‰∏≠...</p>
                    </div>
                    <table v-else class="user-table">
                        <thead>
                            <tr>
                                <th>Â∫èÂè∑</th>
                                <th>Ë¥¶Âè∑</th>
                                <th>Áî®Êà∑ÂêçÁß∞</th>
                                <th>ËßíËâ≤</th>
                                <th>ÁªÑÁªá</th>
                                <th>Áä∂ÊÄÅ</th>
                                <th>ÂàõÂª∫Êó∂Èó¥</th>
                                <th>Êõ¥Êñ∞Êó∂Èó¥</th>
                                <th>Êìç‰Ωú</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-if="userList.length === 0">
                                <td colspan="9" class="empty-cell">
                                    <div class="empty-content">
                                        <div class="empty-icon">üì≠</div>
                                        <p>ÊöÇÊó†Êï∞ÊçÆ</p>
                                    </div>
                                </td>
                            </tr>
                            <tr v-for="(user, index) in userList" :key="user.id">
                                <td>{{ (pagination.current - 1) * pagination.size + index + 1 }}</td>
                                <td>{{ user.username }}</td>
                                <td>{{ user.displayName }}</td>
                                <td>{{ getRoleName(user.roleId) }}</td>
                                <td>{{ getOrgName(user.orgId) }}</td>
                                <td>
                                    <span class="status-badge" :class="getStatusClass(user.status)">
                                        {{ getStatusText(user.status) }}
                                    </span>
                                </td>
                                <td>{{ formatDateTime(user.createTime) }}</td>
                                <td>{{ formatDateTime(user.updateTime) }}</td>
                                <td class="actions">
                                    <button class="action-btn btn-edit" @click="openEditModal(user)">
                                        <span>‚úèÔ∏è</span>
                                        ÁºñËæë
                                    </button>
                                    <button class="action-btn btn-reset" @click="openResetPasswordModal(user)">
                                        <span>üîë</span>
                                        ÈáçÁΩÆÂØÜÁ†Å
                                    </button>
                                    <button class="action-btn btn-delete" @click="handleDelete(user)">
                                        <span>üóëÔ∏è</span>
                                        Âà†Èô§
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- ÂàÜÈ°µ -->
                <div class="pagination" v-if="userList.length > 0">
                    <button
                        class="pagination-btn"
                        :disabled="pagination.current === 1"
                        @click="handlePageChange(pagination.current - 1)"
                    >
                        ‰∏ä‰∏ÄÈ°µ
                    </button>
                    <span class="pagination-info">
                        Á¨¨ {{ pagination.current }} / {{ pagination.pages }} È°µ
                        <span class="pagination-total">ÂÖ± {{ pagination.total }} Êù°ËÆ∞ÂΩï</span>
                    </span>
                    <button
                        class="pagination-btn"
                        :disabled="pagination.current >= pagination.pages"
                        @click="handlePageChange(pagination.current + 1)"
                    >
                        ‰∏ã‰∏ÄÈ°µ
                    </button>
                </div>
            </div>
        </div>

        <!-- Êñ∞Â¢û/ÁºñËæëÁî®Êà∑ÂºπÁ™ó -->
        <div class="modal-overlay" v-if="showUserModal" @click.self="closeUserModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>{{ userModalMode === 'add' ? 'Êñ∞Â¢ûÁî®Êà∑' : 'ÁºñËæëÁî®Êà∑' }}</h2>
                    <button class="modal-close" @click="closeUserModal">‚úï</button>
                </div>
                <div class="modal-body">
                    <form @submit.prevent="handleUserSubmit">
                        <div class="form-group">
                            <label class="form-label">Ë¥¶Âè∑ <span class="required">*</span></label>
                            <input
                                v-model="userForm.username"
                                type="text"
                                class="form-input"
                                placeholder="ËØ∑ËæìÂÖ•Ë¥¶Âè∑"
                                :disabled="userModalMode === 'edit'"
                            >
                        </div>
                        <div class="form-group" v-if="userModalMode === 'add'">
                            <label class="form-label">ÂØÜÁ†Å <span class="required">*</span></label>
                            <input
                                v-model="userForm.password"
                                type="password"
                                class="form-input"
                                placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å"
                            >
                        </div>
                        <div class="form-group">
                            <label class="form-label">Áî®Êà∑ÂêçÁß∞ <span class="required">*</span></label>
                            <input
                                v-model="userForm.displayName"
                                type="text"
                                class="form-input"
                                placeholder="ËØ∑ËæìÂÖ•Áî®Êà∑ÂêçÁß∞"
                            >
                        </div>
                        <div class="form-group">
                            <label class="form-label">Áî®Êà∑ËßíËâ≤ <span class="required">*</span></label>
                            <select v-model="userForm.roleId" class="form-input">
                                <option value="">ËØ∑ÈÄâÊã©ËßíËâ≤</option>
                                <option v-for="role in roleList" :key="role.id" :value="role.id">
                                    {{ role.roleName }}
                                </option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ÊâÄÂ±ûÁªÑÁªá <span class="required">*</span></label>
                            <select v-model="userForm.orgId" class="form-input">
                                <option value="">ËØ∑ÈÄâÊã©ÁªÑÁªá</option>
                                <option v-for="org in orgList" :key="org.id" :value="org.id">
                                    {{ org.fullPath }}
                                </option>
                            </select>
                        </div>
                        <div class="form-group" v-if="userModalMode === 'edit'">
                            <label class="form-label">Áä∂ÊÄÅ</label>
                            <select v-model="userForm.status" class="form-input">
                                <option :value="1">ÊøÄÊ¥ª</option>
                                <option :value="2">Á¶ÅÁî®</option>
                            </select>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" @click="closeUserModal">
                                ÂèñÊ∂à
                            </button>
                            <button type="submit" class="btn btn-primary">
                                Á°ÆÂÆö
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- ÈáçÁΩÆÂØÜÁ†ÅÂºπÁ™ó -->
        <div class="modal-overlay" v-if="showPasswordModal" @click.self="closePasswordModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>ÈáçÁΩÆÂØÜÁ†Å</h2>
                    <button class="modal-close" @click="closePasswordModal">‚úï</button>
                </div>
                <div class="modal-body">
                    <form @submit.prevent="handlePasswordSubmit">
                        <div class="form-group">
                            <label class="form-label">Ë¥¶Âè∑</label>
                            <input
                                :value="passwordForm.username"
                                type="text"
                                class="form-input"
                                disabled
                            >
                        </div>
                        <div class="form-group">
                            <label class="form-label">Êñ∞ÂØÜÁ†Å <span class="required">*</span></label>
                            <input
                                v-model="passwordForm.password"
                                type="password"
                                class="form-input"
                                placeholder="ËØ∑ËæìÂÖ•Êñ∞ÂØÜÁ†Å"
                            >
                        </div>
                        <div class="form-group">
                            <label class="form-label">Á°ÆËÆ§ÂØÜÁ†Å <span class="required">*</span></label>
                            <input
                                v-model="passwordForm.confirmPassword"
                                type="password"
                                class="form-input"
                                placeholder="ËØ∑ÂÜçÊ¨°ËæìÂÖ•Êñ∞ÂØÜÁ†Å"
                            >
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" @click="closePasswordModal">
                                ÂèñÊ∂à
                            </button>
                            <button type="submit" class="btn btn-primary">
                                Á°ÆÂÆö
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- ‰øÆÊîπ‰∏™‰∫∫‰ø°ÊÅØÂºπÁ™ó -->
        <div class="modal-overlay" v-if="showUserProfileModal" @click.self="closeUserProfileModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>‰øÆÊîπ‰∏™‰∫∫‰ø°ÊÅØ</h2>
                    <button class="modal-close" @click="closeUserProfileModal">‚úï</button>
                </div>
                <div class="modal-body">
                    <form @submit.prevent="handleUserProfileSubmit">
                        <div class="form-group">
                            <label class="form-label">Ë¥¶Âè∑</label>
                            <input
                                :value="userProfileForm.username"
                                type="text"
                                class="form-input"
                                disabled
                            >
                        </div>
                        <div class="form-group">
                            <label class="form-label">Áî®Êà∑ÂêçÁß∞ <span class="required">*</span></label>
                            <input
                                v-model="userProfileForm.displayName"
                                type="text"
                                class="form-input"
                                placeholder="ËØ∑ËæìÂÖ•Áî®Êà∑ÂêçÁß∞"
                            >
                        </div>
                        <div class="form-group">
                            <label class="form-label">ÊóßÂØÜÁ†Å</label>
                            <input
                                v-model="userProfileForm.oldPassword"
                                type="password"
                                class="form-input"
                                placeholder="Â¶Ç‰∏ç‰øÆÊîπÂØÜÁ†ÅËØ∑ÁïôÁ©∫"
                            >
                        </div>
                        <div class="form-group">
                            <label class="form-label">Êñ∞ÂØÜÁ†Å</label>
                            <input
                                v-model="userProfileForm.newPassword"
                                type="password"
                                class="form-input"
                                placeholder="Â¶Ç‰∏ç‰øÆÊîπÂØÜÁ†ÅËØ∑ÁïôÁ©∫"
                            >
                        </div>
                        <div class="form-group">
                            <label class="form-label">Á°ÆËÆ§Êñ∞ÂØÜÁ†Å</label>
                            <input
                                v-model="userProfileForm.confirmPassword"
                                type="password"
                                class="form-input"
                                placeholder="Â¶Ç‰∏ç‰øÆÊîπÂØÜÁ†ÅËØ∑ÁïôÁ©∫"
                            >
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" @click="closeUserProfileModal">
                                ÂèñÊ∂à
                            </button>
                            <button type="submit" class="btn btn-primary">
                                ‰øùÂ≠ò
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Vue.js CDN -->
        <script src="https://unpkg.com/vue@3.3.4/dist/vue.global.js"></script>
        <!-- API Â∑•ÂÖ∑ -->
        <script src="/ems/js/api.js"></script>
        <!-- È°∂ÈÉ®ÂØºËà™Ê†èÁªÑ‰ª∂ -->
        <script src="/ems/js/header-component.js"></script>
        <!-- Áî®Êà∑ÁÆ°ÁêÜÈÄªËæë -->
        <script src="/ems/js/user.js"></script>
    </div>
</body>
</html>
