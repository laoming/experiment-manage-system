<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂÆûÈ™åÁÆ°ÁêÜÁ≥ªÁªü - ÁªÑÁªáÁÆ°ÁêÜ</title>
    <link rel="stylesheet" href="/ems/css/common.css">
    <link rel="stylesheet" href="/ems/css/user.css">
</head>
<body>
    <div id="app">
        <!-- È°∂ÈÉ®ÂØºËà™Ê†èÁªÑ‰ª∂ -->
        <header-component @open-profile="openUserProfileModal"></header-component>

        <!-- ‰∏ªÂÜÖÂÆπÂå∫Âüü -->
        <div class="main-content">
            <div class="container">
                <!-- È°µÈù¢Ê†áÈ¢ò -->
                <div class="page-header">
                    <h1 class="page-title">ÁªÑÁªáÁÆ°ÁêÜ</h1>
                    <p class="page-subtitle">ÁÆ°ÁêÜÁ≥ªÁªüÁªÑÁªáÔºåÂåÖÊã¨ÁªÑÁªáÊ∑ªÂä†„ÄÅÁºñËæë„ÄÅÂà†Èô§</p>
                </div>

                <!-- ÊêúÁ¥¢ÂíåÊìç‰ΩúÊ†è -->
                <div class="toolbar">
                    <div class="search-box">
                        <input
                            v-model="queryForm.orgName"
                            type="text"
                            class="search-input"
                            placeholder="ËæìÂÖ•ÁªÑÁªáÂêçÁß∞ÊêúÁ¥¢"
                        >
                        <input
                            v-model="queryForm.orgCode"
                            type="text"
                            class="search-input"
                            placeholder="ËæìÂÖ•ÁªÑÁªáÁºñÁ†ÅÊêúÁ¥¢"
                        >
                        <button class="btn btn-primary" @click="handleSearch">
                            <span>üîç</span>
                            <span>ÊêúÁ¥¢</span>
                        </button>
                        <button class="btn btn-secondary" @click="handleReset">
                            <span>‚Ü∫</span>
                            <span>ÈáçÁΩÆ</span>
                        </button>
                    </div>
                    <button class="btn btn-success" @click="openAddModal">
                        <span>+</span>
                        <span>Êñ∞Â¢ûÁªÑÁªá</span>
                    </button>
                </div>

                <!-- ÁªÑÁªáÂàóË°® -->
                <div class="table-container">
                    <div v-if="loading" class="loading">
                        <div class="loading-spinner"></div>
                        <p>Âä†ËΩΩ‰∏≠...</p>
                    </div>
                    <table v-else class="user-table">
                        <thead>
                            <tr>
                                <th>Â∫èÂè∑</th>
                                <th>ÁªÑÁªáÂêçÁß∞</th>
                                <th>ÁªÑÁªáÁºñÁ†Å</th>
                                <th>ÁªÑÁªáÊèèËø∞</th>
                                <th>ÂàõÂª∫Êó∂Èó¥</th>
                                <th>Êõ¥Êñ∞Êó∂Èó¥</th>
                                <th>Êìç‰Ωú</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-if="organizationList.length === 0">
                                <td colspan="7" class="empty-cell">
                                    <div class="empty-content">
                                        <div class="empty-icon">üì≠</div>
                                        <p>ÊöÇÊó†Êï∞ÊçÆ</p>
                                    </div>
                                </td>
                            </tr>
                            <tr v-for="(org, index) in organizationList" :key="org.id">
                                <td>{{ (pagination.current - 1) * pagination.size + index + 1 }}</td>
                                <td>{{ org.orgName }}</td>
                                <td>{{ org.orgCode }}</td>
                                <td>{{ org.description || '-' }}</td>
                                <td>{{ formatDateTime(org.createTime) }}</td>
                                <td>{{ formatDateTime(org.updateTime) }}</td>
                                <td class="actions">
                                    <button class="action-btn btn-edit" @click="openEditModal(org)">
                                        <span>‚úèÔ∏è</span>
                                        ÁºñËæë
                                    </button>
                                    <button class="action-btn btn-delete" @click="handleDelete(org)">
                                        <span>üóëÔ∏è</span>
                                        Âà†Èô§
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- ÂàÜÈ°µ -->
                <div class="pagination" v-if="organizationList.length > 0">
                    <button
                        class="pagination-btn"
                        :disabled="pagination.current === 1"
                        @click="handlePageChange(pagination.current - 1)"
                    >
                        ‰∏ä‰∏ÄÈ°µ
                    </button>
                    <span class="pagination-info">
                        Á¨¨ {{ pagination.current }} / {{ pagination.pages }} È°µ
                        <span class="pagination-total">ÂÖ± {{ pagination.total }} Êù°ËÆ∞ÂΩï</span>
                    </span>
                    <button
                        class="pagination-btn"
                        :disabled="pagination.current >= pagination.pages"
                        @click="handlePageChange(pagination.current + 1)"
                    >
                        ‰∏ã‰∏ÄÈ°µ
                    </button>
                </div>
            </div>
        </div>

        <!-- Êñ∞Â¢û/ÁºñËæëÁªÑÁªáÂºπÁ™ó -->
        <div class="modal-overlay" v-if="showOrgModal" @click.self="closeOrgModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>{{ orgModalMode === 'add' ? 'Êñ∞Â¢ûÁªÑÁªá' : 'ÁºñËæëÁªÑÁªá' }}</h2>
                    <button class="modal-close" @click="closeOrgModal">‚úï</button>
                </div>
                <div class="modal-body">
                    <form @submit.prevent="handleOrgSubmit">
                        <div class="form-group">
                            <label class="form-label">ÁªÑÁªáÂêçÁß∞ <span class="required">*</span></label>
                            <input
                                v-model="orgForm.orgName"
                                type="text"
                                class="form-input"
                                placeholder="ËØ∑ËæìÂÖ•ÁªÑÁªáÂêçÁß∞"
                            >
                        </div>
                        <div class="form-group">
                            <label class="form-label">ÁªÑÁªáÁºñÁ†Å <span class="required">*</span></label>
                            <input
                                v-model="orgForm.orgCode"
                                type="text"
                                class="form-input"
                                placeholder="ËØ∑ËæìÂÖ•ÁªÑÁªáÁºñÁ†Å"
                                :disabled="orgModalMode === 'edit'"
                            >
                        </div>
                        <div class="form-group">
                            <label class="form-label">ÁªÑÁªáÊèèËø∞</label>
                            <textarea
                                v-model="orgForm.description"
                                class="form-input"
                                placeholder="ËØ∑ËæìÂÖ•ÁªÑÁªáÊèèËø∞"
                                rows="4"
                            ></textarea>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" @click="closeOrgModal">
                                ÂèñÊ∂à
                            </button>
                            <button type="submit" class="btn btn-primary">
                                Á°ÆÂÆö
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Vue.js CDN -->
        <script src="https://unpkg.com/vue@3.3.4/dist/vue.global.js"></script>
        <!-- API Â∑•ÂÖ∑ -->
        <script src="/ems/js/api.js"></script>
        <!-- È°∂ÈÉ®ÂØºËà™Ê†èÁªÑ‰ª∂ -->
        <script src="/ems/js/header-component.js"></script>
        <!-- ÁªÑÁªáÁÆ°ÁêÜÈÄªËæë -->
        <script src="/ems/js/organization.js"></script>
    </div>
</body>
</html>
