<link rel="stylesheet" href="/ems/common/css/common.css">
<link rel="stylesheet" href="/ems/common/css/user.css">


<div class="main-content">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="page-header" v-if="!pageError">
        <h1 class="page-title">ç”¨æˆ·ç®¡ç†</h1>
        <p class="page-subtitle">ç®¡ç†ç³»ç»Ÿç”¨æˆ·ï¼ŒåŒ…æ‹¬ç”¨æˆ·æ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤ä»¥åŠå¯†ç é‡ç½®</p>
    </div>

    <!-- æœç´¢å’Œæ“ä½œæ  -->
    <div class="toolbar">
        <div class="search-box">
            <input
                v-model="queryForm.username"
                type="text"
                class="search-input"
                placeholder="è¾“å…¥è´¦å·æœç´¢"
            >
            <input
                v-model="queryForm.displayName"
                type="text"
                class="search-input"
                placeholder="è¾“å…¥ç”¨æˆ·åç§°æœç´¢"
            >
            <select v-model="queryForm.roleId" class="search-select">
                <option :value="null">å…¨éƒ¨è§’è‰²</option>
                <option v-for="role in roleList" :key="role.id" :value="role.id">
                    {{ role.roleName }}
                </option>
            </select>
            <select v-model="queryForm.status" class="search-select">
                <option :value="null">å…¨éƒ¨çŠ¶æ€</option>
                <option :value="1">æ¿€æ´»</option>
                <option :value="2">ç¦ç”¨</option>
            </select>
            <button class="btn btn-primary" @click="handleSearch">
                <span>ğŸ”</span>
                <span>æœç´¢</span>
            </button>
            <button class="btn btn-secondary" @click="handleReset">
                <span>â†º</span>
                <span>é‡ç½®</span>
            </button>
        </div>
        <button class="btn btn-success" @click="openAddModal">
            <span>+</span>
            <span>æ–°å¢ç”¨æˆ·</span>
        </button>
    </div>

    <!-- ç”¨æˆ·åˆ—è¡¨ -->
    <div class="table-container">
        <div v-if="loading" class="loading">
            <div class="loading-spinner"></div>
            <p>åŠ è½½ä¸­...</p>
        </div>
        <table v-else class="user-table">
            <thead>
                <tr>
                    <th>åºå·</th>
                    <th>è´¦å·</th>
                    <th>ç”¨æˆ·åç§°</th>
                    <th>è§’è‰²</th>
                    <th>ç»„ç»‡</th>
                    <th>çŠ¶æ€</th>
                    <th>åˆ›å»ºæ—¶é—´</th>
                    <th>æ›´æ–°æ—¶é—´</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                <tr v-if="userList.length === 0">
                    <td colspan="9" class="empty-cell">
                        <div class="empty-content">
                            <div class="empty-icon">ğŸ“­</div>
                            <p>æš‚æ— æ•°æ®</p>
                        </div>
                    </td>
                </tr>
                <tr v-for="(user, index) in userList" :key="user.id">
                    <td>{{ (pagination.current - 1) * pagination.size + index + 1 }}</td>
                    <td>{{ user.username }}</td>
                    <td>{{ user.displayName }}</td>
                    <td>{{ getRoleName(user.roleId) }}</td>
                    <td>{{ getOrgName(user.orgId) }}</td>
                    <td>
                        <span class="status-badge" :class="getStatusClass(user.status)">
                            {{ getStatusText(user.status) }}
                        </span>
                    </td>
                    <td>{{ formatDateTime(user.createTime) }}</td>
                    <td>{{ formatDateTime(user.updateTime) }}</td>
                    <td class="actions">
                        <button class="action-btn btn-edit" @click="openEditModal(user)">
                            <span>âœï¸</span>
                            ç¼–è¾‘
                        </button>
                        <button class="action-btn btn-reset" @click="openResetPasswordModal(user)">
                            <span>ğŸ”‘</span>
                            é‡ç½®å¯†ç 
                        </button>
                        <button class="action-btn btn-delete" @click="handleDelete(user)">
                            <span>ğŸ—‘ï¸</span>
                            åˆ é™¤
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- åˆ†é¡µ -->
    <div class="pagination" v-if="userList.length > 0">
        <button
            class="pagination-btn"
            :disabled="pagination.current === 1"
            @click="handlePageChange(pagination.current - 1)"
        >
            ä¸Šä¸€é¡µ
        </button>
        <span class="pagination-info">
            ç¬¬ {{ pagination.current }} / {{ pagination.pages }} é¡µ
            <span class="pagination-total">å…± {{ pagination.total }} æ¡è®°å½•</span>
        </span>
        <button
            class="pagination-btn"
            :disabled="pagination.current >= pagination.pages"
            @click="handlePageChange(pagination.current + 1)"
        >
            ä¸‹ä¸€é¡µ
        </button>
    </div>

    <!-- ç”¨æˆ·ç¼–è¾‘å¼¹çª— -->
    <div class="modal-overlay" v-show="showUserModal" style="display: none;" @click.self="closeUserModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>{{ userModalMode === 'add' ? 'æ–°å¢ç”¨æˆ·' : 'ç¼–è¾‘ç”¨æˆ·' }}</h2>
                <button class="modal-close" @click="closeUserModal">âœ•</button>
            </div>
            <div class="modal-body">
                <form @submit.prevent="handleUserSubmit">
                    <div class="form-group">
                        <label class="form-label">è´¦å· <span class="required">*</span></label>
                        <input
                            v-model="userForm.username"
                            type="text"
                            class="form-input"
                            placeholder="è¯·è¾“å…¥è´¦å·"
                            :disabled="userModalMode === 'edit'"
                        >
                    </div>
                    <div class="form-group" v-if="userModalMode === 'add'">
                        <label class="form-label">å¯†ç  <span class="required">*</span></label>
                        <input
                            v-model="userForm.password"
                            type="password"
                            class="form-input"
                            placeholder="è¯·è¾“å…¥å¯†ç "
                        >
                    </div>
                    <div class="form-group">
                        <label class="form-label">ç”¨æˆ·åç§° <span class="required">*</span></label>
                        <input
                            v-model="userForm.displayName"
                            type="text"
                            class="form-input"
                            placeholder="è¯·è¾“å…¥ç”¨æˆ·åç§°"
                        >
                    </div>
                    <div class="form-group">
                        <label class="form-label">ç”¨æˆ·è§’è‰² <span class="required">*</span></label>
                        <select v-model="userForm.roleId" class="form-input">
                            <option value="">è¯·é€‰æ‹©è§’è‰²</option>
                            <option v-for="role in roleList" :key="role.id" :value="role.id">
                                {{ role.roleName }}
                            </option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">æ‰€å±ç»„ç»‡ <span class="required">*</span></label>
                        <select v-model="userForm.orgId" class="form-input">
                            <option value="">è¯·é€‰æ‹©ç»„ç»‡</option>
                            <option v-for="org in orgList" :key="org.id" :value="org.id">
                                {{ org.fullPath }}
                            </option>
                        </select>
                    </div>
                    <div class="form-group" v-if="userModalMode === 'edit'">
                        <label class="form-label">çŠ¶æ€</label>
                        <select v-model="userForm.status" class="form-input">
                            <option :value="1">æ¿€æ´»</option>
                            <option :value="2">ç¦ç”¨</option>
                        </select>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" @click="closeUserModal">
                            å–æ¶ˆ
                        </button>
                        <button type="submit" class="btn btn-primary">
                            ç¡®å®š
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- é‡ç½®å¯†ç å¼¹çª— -->
    <div class="modal-overlay" v-show="showPasswordModal" style="display: none;" @click.self="closePasswordModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>é‡ç½®å¯†ç </h2>
                <button class="modal-close" @click="closePasswordModal">âœ•</button>
            </div>
            <div class="modal-body">
                <form @submit.prevent="handlePasswordSubmit">
                    <div class="form-group">
                        <label class="form-label">è´¦å·</label>
                        <input
                            :value="passwordForm.username"
                            type="text"
                            class="form-input"
                            disabled
                        >
                    </div>
                    <div class="form-group">
                        <label class="form-label">æ–°å¯†ç  <span class="required">*</span></label>
                        <input
                            v-model="passwordForm.password"
                            type="password"
                            class="form-input"
                            placeholder="è¯·è¾“å…¥æ–°å¯†ç "
                        >
                    </div>
                    <div class="form-group">
                        <label class="form-label">ç¡®è®¤å¯†ç  <span class="required">*</span></label>
                        <input
                            v-model="passwordForm.confirmPassword"
                            type="password"
                            class="form-input"
                            placeholder="è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç "
                        >
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" @click="closePasswordModal">
                            å–æ¶ˆ
                        </button>
                        <button type="submit" class="btn btn-primary">
                            ç¡®å®š
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="/ems/modules/js/user.js"></script>

