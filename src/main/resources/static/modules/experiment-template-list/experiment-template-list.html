<link rel="stylesheet" href="/ems/modules/experiment-template-list/experiment-template-list.css">

<!-- MathJax ç”¨äºå…¬å¼æ¸²æŸ“ -->
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<div class="main-content" v-cloak>
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="page-header">
        <h1 class="page-title">å®éªŒæ¨¡æ¿ç®¡ç†</h1>
        <p class="page-subtitle">ç®¡ç†ç³»ç»Ÿå®éªŒæ¨¡æ¿ï¼ŒåŒ…æ‹¬æ¨¡æ¿çš„åˆ›å»ºã€ç¼–è¾‘ã€æŸ¥çœ‹å’Œåˆ é™¤</p>
    </div>

    <!-- æœç´¢å’Œæ“ä½œæ  -->
    <div class="toolbar">
        <div class="search-box">
            <input
                v-model="queryForm.templateName"
                type="text"
                class="search-input"
                placeholder="è¾“å…¥æ¨¡æ¿åç§°æœç´¢"
            >
            <button class="btn btn-primary" @click="handleSearch">
                <span>ğŸ”</span>
                <span>æœç´¢</span>
            </button>
            <button class="btn btn-secondary" @click="handleReset">
                <span>â†º</span>
                <span>é‡ç½®</span>
            </button>
        </div>
        <button class="btn btn-success" @click="openCreateEditor">
            <span>+</span>
            <span>åˆ›å»ºæ¨¡æ¿</span>
        </button>
    </div>

    <!-- æ¨¡æ¿åˆ—è¡¨ -->
    <div class="table-container">
        <div v-if="loading" class="loading">
            <div class="loading-spinner"></div>
            <p>åŠ è½½ä¸­...</p>
        </div>
        <table v-else class="template-table">
            <thead>
                <tr>
                    <th>åºå·</th>
                    <th>æ¨¡æ¿åç§°</th>
                    <th>æè¿°</th>
                    <th>åˆ›å»ºè€…</th>
                    <th>åˆ›å»ºæ—¶é—´</th>
                    <th>æ›´æ–°æ—¶é—´</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                <tr v-if="templateList.length === 0">
                    <td colspan="7" class="empty-cell">
                        <div class="empty-content">
                            <div class="empty-icon">ğŸ“­</div>
                            <p>æš‚æ— æ•°æ®</p>
                        </div>
                    </td>
                </tr>
                <tr v-for="(template, index) in templateList" :key="template.id">
                    <td>{{ (pagination.current - 1) * pagination.size + index + 1 }}</td>
                    <td>{{ template.templateName }}</td>
                    <td>
                        <div class="description-preview">
                            {{ template.description || '-' }}
                        </div>
                    </td>
                    <td>{{ getCreatorName(template.creatorId) }}</td>
                    <td>{{ formatDateTime(template.createTime) }}</td>
                    <td>{{ formatDateTime(template.updateTime) }}</td>
                    <td class="actions">
                        <button class="action-btn btn-view" @click="openViewModal(template)">
                            <span>ğŸ‘ï¸</span>
                            æŸ¥çœ‹
                        </button>
                        <button class="action-btn btn-edit" @click="openEditEditor(template)">
                            <span>âœï¸</span>
                            ç¼–è¾‘
                        </button>
                        <button class="action-btn btn-delete" @click="handleDelete(template)">
                            <span>ğŸ—‘ï¸</span>
                            åˆ é™¤
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- åˆ†é¡µ -->
    <div class="pagination" v-if="templateList.length > 0">
        <button
            class="pagination-btn"
            :disabled="pagination.current === 1"
            @click="handlePageChange(pagination.current - 1)"
        >
            ä¸Šä¸€é¡µ
        </button>
        <span class="pagination-info">
            ç¬¬ {{ pagination.current }} / {{ pagination.pages }} é¡µ
            <span class="pagination-total">å…± {{ pagination.total }} æ¡è®°å½•</span>
        </span>
        <button
            class="pagination-btn"
            :disabled="pagination.current >= pagination.pages"
            @click="handlePageChange(pagination.current + 1)"
        >
            ä¸‹ä¸€é¡µ
        </button>
    </div>

    <!-- æŸ¥çœ‹æ¨¡æ¿å¼¹çª— -->
    <div class="modal-overlay" v-show="showViewModal" style="display: none;" @click.self="closeViewModal">
        <div class="modal-content modal-large template-view-modal">
            <div class="modal-header">
                <h2>æŸ¥çœ‹æ¨¡æ¿ - {{ currentTemplate.templateName }}</h2>
                <button class="modal-close" @click="closeViewModal">âœ•</button>
            </div>
            <div class="modal-body template-view-body">
                <!-- æ¨¡æ¿ä¿¡æ¯ -->
                <div class="template-info-bar">
                    <div class="info-item">
                        <span class="info-label">åˆ›å»ºè€…ï¼š</span>
                        <span class="info-value">{{ getCreatorName(currentTemplate.creatorId) }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">åˆ›å»ºæ—¶é—´ï¼š</span>
                        <span class="info-value">{{ formatDateTime(currentTemplate.createTime) }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">æ›´æ–°æ—¶é—´ï¼š</span>
                        <span class="info-value">{{ formatDateTime(currentTemplate.updateTime) }}</span>
                    </div>
                </div>
                <!-- æ¨¡æ¿æè¿° -->
                <div class="template-description-view" v-if="currentTemplate.description">
                    <div class="description-label">æ¨¡æ¿æè¿°</div>
                    <div class="description-text">{{ currentTemplate.description }}</div>
                </div>
                <!-- æ¨¡æ¿å†…å®¹é¢„è§ˆ -->
                <div class="template-preview-container">
                    <div class="preview-label">æ¨¡æ¿å†…å®¹</div>
                    <div class="template-preview-canvas" id="viewCanvas" ref="viewCanvas"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" @click="closeViewModal">
                    å…³é—­
                </button>
            </div>
        </div>
    </div>
</div>

<script src="/ems/modules/experiment-template-list/experiment-template-list.js"></script>
