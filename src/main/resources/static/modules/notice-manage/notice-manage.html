<link rel="stylesheet" href="/ems/modules/notice-manage/notice-manage.css">

<div class="main-content">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="page-header" v-if="!pageError">
        <h1 class="page-title">é€šçŸ¥ä¸å…¬å‘Šç®¡ç†</h1>
        <p class="page-subtitle">å‘å¸ƒç³»ç»Ÿå…¬å‘Šä¸æŒ‡å®šç”¨æˆ·å¾…åŠ</p>
    </div>

    <!-- æ ‡ç­¾åˆ‡æ¢ -->
    <div class="tab-bar">
        <button class="tab-btn" :class="{ active: activeTab === 'notice' }" @click="switchTab('notice')">
            å…¬å‘Šç®¡ç†
        </button>
        <button class="tab-btn" :class="{ active: activeTab === 'todo' }" @click="switchTab('todo')">
            å¾…åŠç®¡ç†
        </button>
    </div>

    <!-- å…¬å‘Šç®¡ç† -->
    <div v-show="activeTab === 'notice'">
        <div class="toolbar">
            <div class="search-box">
                <input
                    v-model="noticeQueryForm.title"
                    type="text"
                    class="search-input"
                    placeholder="è¾“å…¥å…¬å‘Šæ ‡é¢˜æœç´¢"
                >
                <button class="btn btn-primary" @click="handleNoticeSearch">
                    <span>ğŸ”</span>
                    <span>æœç´¢</span>
                </button>
                <button class="btn btn-secondary" @click="handleNoticeReset">
                    <span>â†º</span>
                    <span>é‡ç½®</span>
                </button>
            </div>
            <button class="btn btn-success" @click="openNoticeModal">
                <span>+</span>
                <span>å‘å¸ƒå…¬å‘Š</span>
            </button>
        </div>

        <div class="table-container">
            <div v-if="noticeLoading" class="loading">
                <div class="loading-spinner"></div>
                <p>åŠ è½½ä¸­...</p>
            </div>
            <table v-else class="notice-table">
                <thead>
                    <tr>
                        <th>åºå·</th>
                        <th>æ ‡é¢˜</th>
                        <th>å†…å®¹</th>
                        <th>å‘å¸ƒäºº</th>
                        <th>åˆ›å»ºæ—¶é—´</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-if="noticeList.length === 0">
                        <td colspan="6" class="empty-cell">
                            <div class="empty-content">
                                <div class="empty-icon">ğŸ“­</div>
                                <p>æš‚æ— æ•°æ®</p>
                            </div>
                        </td>
                    </tr>
                    <tr v-for="(notice, index) in noticeList" :key="notice.id">
                        <td>{{ (noticePagination.current - 1) * noticePagination.size + index + 1 }}</td>
                        <td class="text-strong">{{ notice.title }}</td>
                        <td class="text-muted">{{ notice.content }}</td>
                        <td>{{ notice.creatorName }}</td>
                        <td>{{ formatDateTime(notice.createTime) }}</td>
                        <td class="actions">
                            <button class="action-btn btn-delete" @click="handleDeleteNotice(notice)">
                                <span>ğŸ—‘ï¸</span>
                                åˆ é™¤
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="pagination" v-if="noticeList.length > 0">
            <button
                class="pagination-btn"
                :disabled="noticePagination.current === 1"
                @click="handleNoticePageChange(noticePagination.current - 1)"
            >
                ä¸Šä¸€é¡µ
            </button>
            <span class="pagination-info">
                ç¬¬ {{ noticePagination.current }} / {{ noticePagination.pages }} é¡µ
                <span class="pagination-total">å…± {{ noticePagination.total }} æ¡è®°å½•</span>
            </span>
            <button
                class="pagination-btn"
                :disabled="noticePagination.current >= noticePagination.pages"
                @click="handleNoticePageChange(noticePagination.current + 1)"
            >
                ä¸‹ä¸€é¡µ
            </button>
        </div>
    </div>

    <!-- å¾…åŠç®¡ç† -->
    <div v-show="activeTab === 'todo'">
        <div class="toolbar">
            <div class="search-box">
                <input
                    v-model="todoQueryForm.title"
                    type="text"
                    class="search-input"
                    placeholder="è¾“å…¥å¾…åŠæ ‡é¢˜æœç´¢"
                >
                <select v-model="todoQueryForm.receiverId" class="search-select">
                    <option value="">å…¨éƒ¨ç”¨æˆ·</option>
                    <option v-for="user in userOptions" :key="user.id" :value="user.id">
                        {{ user.displayName || user.username }}
                    </option>
                </select>
                <select v-model="todoQueryForm.status" class="search-select">
                    <option :value="null">å…¨éƒ¨çŠ¶æ€</option>
                    <option :value="0">æœªå®Œæˆ</option>
                    <option :value="1">å·²å®Œæˆ</option>
                </select>
                <button class="btn btn-primary" @click="handleTodoSearch">
                    <span>ğŸ”</span>
                    <span>æœç´¢</span>
                </button>
                <button class="btn btn-secondary" @click="handleTodoReset">
                    <span>â†º</span>
                    <span>é‡ç½®</span>
                </button>
            </div>
            <button class="btn btn-success" @click="openTodoModal">
                <span>+</span>
                <span>åˆ›å»ºå¾…åŠ</span>
            </button>
        </div>

        <div class="table-container">
            <div v-if="todoLoading" class="loading">
                <div class="loading-spinner"></div>
                <p>åŠ è½½ä¸­...</p>
            </div>
            <table v-else class="todo-table">
                <thead>
                    <tr>
                        <th>åºå·</th>
                        <th>æ ‡é¢˜</th>
                        <th>å†…å®¹</th>
                        <th>æ¥æ”¶äºº</th>
                        <th>çŠ¶æ€</th>
                        <th>åˆ›å»ºæ—¶é—´</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-if="todoList.length === 0">
                        <td colspan="7" class="empty-cell">
                            <div class="empty-content">
                                <div class="empty-icon">ğŸ“­</div>
                                <p>æš‚æ— æ•°æ®</p>
                            </div>
                        </td>
                    </tr>
                    <tr v-for="(todo, index) in todoList" :key="todo.id">
                        <td>{{ (todoPagination.current - 1) * todoPagination.size + index + 1 }}</td>
                        <td class="text-strong">{{ todo.title }}</td>
                        <td class="text-muted">{{ todo.content }}</td>
                        <td>{{ todo.receiverName }}</td>
                        <td>
                            <span class="status-badge" :class="getTodoStatusClass(todo.status)">
                                {{ getTodoStatusText(todo.status) }}
                            </span>
                        </td>
                        <td>{{ formatDateTime(todo.createTime) }}</td>
                        <td class="actions">
                            <button class="action-btn btn-delete" @click="handleDeleteTodo(todo)">
                                <span>ğŸ—‘ï¸</span>
                                åˆ é™¤
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="pagination" v-if="todoList.length > 0">
            <button
                class="pagination-btn"
                :disabled="todoPagination.current === 1"
                @click="handleTodoPageChange(todoPagination.current - 1)"
            >
                ä¸Šä¸€é¡µ
            </button>
            <span class="pagination-info">
                ç¬¬ {{ todoPagination.current }} / {{ todoPagination.pages }} é¡µ
                <span class="pagination-total">å…± {{ todoPagination.total }} æ¡è®°å½•</span>
            </span>
            <button
                class="pagination-btn"
                :disabled="todoPagination.current >= todoPagination.pages"
                @click="handleTodoPageChange(todoPagination.current + 1)"
            >
                ä¸‹ä¸€é¡µ
            </button>
        </div>
    </div>

    <!-- å‘å¸ƒå…¬å‘Šå¼¹çª— -->
    <div class="modal-overlay" v-show="showNoticeModal" style="display: none;" @click.self="closeNoticeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>å‘å¸ƒå…¬å‘Š</h2>
                <button class="modal-close" @click="closeNoticeModal">âœ•</button>
            </div>
            <div class="modal-body">
                <form @submit.prevent="handleNoticeSubmit">
                    <div class="form-group">
                        <label class="form-label">å…¬å‘Šæ ‡é¢˜ <span class="required">*</span></label>
                        <input
                            v-model="noticeForm.title"
                            type="text"
                            class="form-input"
                            placeholder="è¯·è¾“å…¥å…¬å‘Šæ ‡é¢˜"
                        >
                    </div>
                    <div class="form-group">
                        <label class="form-label">å…¬å‘Šå†…å®¹ <span class="required">*</span></label>
                        <textarea
                            v-model="noticeForm.content"
                            class="form-textarea"
                            placeholder="è¯·è¾“å…¥å…¬å‘Šå†…å®¹"
                            rows="5"
                        ></textarea>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" @click="closeNoticeModal">
                            å–æ¶ˆ
                        </button>
                        <button type="submit" class="btn btn-primary">
                            å‘å¸ƒ
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- åˆ›å»ºå¾…åŠå¼¹çª— -->
    <div class="modal-overlay" v-show="showTodoModal" style="display: none;" @click.self="closeTodoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>åˆ›å»ºå¾…åŠ</h2>
                <button class="modal-close" @click="closeTodoModal">âœ•</button>
            </div>
            <div class="modal-body">
                <form @submit.prevent="handleTodoSubmit">
                    <div class="form-group">
                        <label class="form-label">å¾…åŠæ ‡é¢˜ <span class="required">*</span></label>
                        <input
                            v-model="todoForm.title"
                            type="text"
                            class="form-input"
                            placeholder="è¯·è¾“å…¥å¾…åŠæ ‡é¢˜"
                        >
                    </div>
                    <div class="form-group">
                        <label class="form-label">æ¥æ”¶äºº <span class="required">*</span></label>
                        <select v-model="todoForm.receiverId" class="form-input">
                            <option value="">è¯·é€‰æ‹©ç”¨æˆ·</option>
                            <option v-for="user in userOptions" :key="user.id" :value="user.id">
                                {{ user.displayName || user.username }}
                            </option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">å¾…åŠå†…å®¹ <span class="required">*</span></label>
                        <textarea
                            v-model="todoForm.content"
                            class="form-textarea"
                            placeholder="è¯·è¾“å…¥å¾…åŠå†…å®¹"
                            rows="5"
                        ></textarea>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" @click="closeTodoModal">
                            å–æ¶ˆ
                        </button>
                        <button type="submit" class="btn btn-primary">
                            åˆ›å»º
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="/ems/modules/notice-manage/notice-manage.js"></script>
