<link rel="stylesheet" href="/ems/modules/my-course/my-course.css">

<div class="main-content" v-cloak>
    <!-- é¡µé¢é”™è¯¯æç¤º -->
    <div v-if="pageError && !loading" class="page-error">
        <div class="error-icon">âš ï¸</div>
        <h2>é¡µé¢åŠ è½½å‡ºé”™</h2>
        <p>{{ pageError }}</p>
        <button class="btn btn-primary" @click="loadData">é‡æ–°åŠ è½½</button>
    </div>

    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="page-header" v-else>
        <h1 class="page-title">æˆ‘çš„è¯¾ç¨‹</h1>
        <p class="page-subtitle">æŸ¥çœ‹æ‚¨å‚ä¸çš„æ‰€æœ‰è¯¾ç¨‹</p>
    </div>

    <!-- æœç´¢å’Œæ“ä½œæ  -->
    <div class="toolbar" v-if="!pageError">
        <div class="search-box">
            <input
                v-model="queryForm.courseName"
                type="text"
                class="search-input"
                placeholder="è¾“å…¥è¯¾ç¨‹åç§°æœç´¢"
                @keyup.enter="handleSearch"
            >
            <button class="btn btn-primary" @click="handleSearch">
                <span>ğŸ”</span>
                <span>æœç´¢</span>
            </button>
            <button class="btn btn-secondary" @click="handleReset">
                <span>â†º</span>
                <span>é‡ç½®</span>
            </button>
        </div>
    </div>

    <!-- è¯¾ç¨‹åˆ—è¡¨ -->
    <div class="table-container" v-if="!pageError">
        <div v-if="loading" class="loading">
            <div class="loading-spinner"></div>
            <p>åŠ è½½ä¸­...</p>
        </div>
        <table v-else class="course-table">
            <thead>
                <tr>
                    <th>åºå·</th>
                    <th>è¯¾ç¨‹åç§°</th>
                    <th>ç®€ä»‹</th>
                    <th>åˆ›å»ºè€…</th>
                    <th>å­¦ç”Ÿäººæ•°</th>
                    <th>å®éªŒæ¨¡æ¿æ•°</th>
                    <th>åˆ›å»ºæ—¶é—´</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                <tr v-if="courseList.length === 0">
                    <td colspan="8" class="empty-cell">
                        <div class="empty-content">
                            <div class="empty-icon">ğŸ“š</div>
                            <p>æš‚æ— è¯¾ç¨‹æ•°æ®</p>
                        </div>
                    </td>
                </tr>
                <tr v-for="(course, index) in courseList" :key="course.id">
                    <td>{{ (pagination.current - 1) * pagination.size + index + 1 }}</td>
                    <td>{{ course.courseName }}</td>
                    <td>
                        <div class="description-preview">
                            {{ course.description || '-' }}
                        </div>
                    </td>
                    <td>{{ getCreatorName(course.creatorId) }}</td>
                    <td>
                        <span class="badge">{{ getStudentCount(course.id) }} äºº</span>
                    </td>
                    <td>
                        <span class="badge">{{ getTemplateCount(course.id) }} ä¸ª</span>
                    </td>
                    <td>{{ formatDateTime(course.createTime) }}</td>
                    <td class="actions">
                        <button class="action-btn btn-view" @click="openViewModal(course)">
                            <span>ğŸ‘ï¸</span>
                            æŸ¥çœ‹
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- åˆ†é¡µ -->
    <div class="pagination" v-if="courseList.length > 0 && !pageError">
        <button
            class="pagination-btn"
            :disabled="pagination.current === 1"
            @click="handlePageChange(pagination.current - 1)"
        >
            ä¸Šä¸€é¡µ
        </button>
        <span class="pagination-info">
            ç¬¬ {{ pagination.current }} / {{ pagination.pages }} é¡µ
            <span class="pagination-total">å…± {{ pagination.total }} æ¡è®°å½•</span>
        </span>
        <button
            class="pagination-btn"
            :disabled="pagination.current >= pagination.pages"
            @click="handlePageChange(pagination.current + 1)"
        >
            ä¸‹ä¸€é¡µ
        </button>
    </div>

    <!-- æŸ¥çœ‹è¯¾ç¨‹å¼¹çª— -->
    <div class="modal-overlay" v-show="showViewModal && !pageError" style="display: none;" @click.self="closeViewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>æŸ¥çœ‹è¯¾ç¨‹</h2>
                <button class="modal-close" @click="closeViewModal">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="view-item">
                    <label class="view-label">è¯¾ç¨‹åç§°ï¼š</label>
                    <span class="view-value">{{ currentCourse.courseName }}</span>
                </div>
                <div class="view-item">
                    <label class="view-label">åˆ›å»ºè€…ï¼š</label>
                    <span class="view-value">{{ getCreatorName(currentCourse.creatorId) }}</span>
                </div>
                <div class="view-item">
                    <label class="view-label">å­¦ç”Ÿäººæ•°ï¼š</label>
                    <span class="view-value">{{ getStudentCount(currentCourse.id) }} äºº</span>
                </div>
                <div class="view-item">
                    <label class="view-label">å®éªŒæ¨¡æ¿æ•°ï¼š</label>
                    <span class="view-value">{{ getTemplateCount(currentCourse.id) }} ä¸ª</span>
                </div>
                <div class="view-item">
                    <label class="view-label">åˆ›å»ºæ—¶é—´ï¼š</label>
                    <span class="view-value">{{ formatDateTime(currentCourse.createTime) }}</span>
                </div>
                <div class="view-item">
                    <label class="view-label">æ›´æ–°æ—¶é—´ï¼š</label>
                    <span class="view-value">{{ formatDateTime(currentCourse.updateTime) }}</span>
                </div>
                <div class="view-item">
                    <label class="view-label">è¯¾ç¨‹ç®€ä»‹ï¼š</label>
                    <p class="view-description">{{ currentCourse.description || 'æ— ' }}</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" @click="closeViewModal">
                        å…³é—­
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/ems/modules/my-course/my-course.js"></script>
