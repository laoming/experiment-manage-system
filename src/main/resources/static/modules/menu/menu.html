<link rel="stylesheet" href="/ems/modules/menu/menu.css">


<div class="main-content" v-cloak>
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="page-header" v-if="!pageError">
        <h1 class="page-title">èœå•ç®¡ç†</h1>
        <p class="page-subtitle">ç®¡ç†ç³»ç»Ÿèœå•ï¼ŒåŒ…æ‹¬èœå•æ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤</p>
    </div>

    <!-- æœç´¢å’Œæ“ä½œæ  -->
    <div class="toolbar">
        <div class="search-box">
            <input
                v-model="queryForm.menuName"
                type="text"
                class="search-input"
                placeholder="è¾“å…¥èœå•åç§°æœç´¢"
            >
            <select v-model="queryForm.menuType" class="search-select">
                <option :value="null">å…¨éƒ¨ç±»å‹</option>
                <option value="M">èœå•</option>
                <option value="D">ç›®å½•</option>
            </select>
            <button class="btn btn-primary" @click="handleSearch">
                <span>ğŸ”</span>
                <span>æœç´¢</span>
            </button>
            <button class="btn btn-secondary" @click="handleReset">
                <span>â†º</span>
                <span>é‡ç½®</span>
            </button>
        </div>
        <button class="btn btn-success" @click="openAddModal">
            <span>+</span>
            <span>æ–°å¢èœå•</span>
        </button>
    </div>

    <!-- èœå•åˆ—è¡¨ -->
    <div class="table-container">
        <div v-if="loading" class="loading">
            <div class="loading-spinner"></div>
            <p>åŠ è½½ä¸­...</p>
        </div>
        <table v-else class="menu-table">
            <thead>
                <tr>
                    <th>åºå·</th>
                    <th>èœå•åç§°</th>
                    <th>èœå•ç¼–ç </th>
                    <th>èœå•è·¯å¾„</th>
                    <th>ç±»å‹</th>
                    <th>æ’åº</th>
                    <th>åˆ›å»ºæ—¶é—´</th>
                    <th>æ›´æ–°æ—¶é—´</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                <tr v-if="menuList.length === 0">
                    <td colspan="9" class="empty-cell">
                        <div class="empty-content">
                            <div class="empty-icon">ğŸ“­</div>
                            <p>æš‚æ— æ•°æ®</p>
                        </div>
                    </td>
                </tr>
                <tr v-for="(menu, index) in menuList" :key="menu.id">
                    <td>{{ (pagination.current - 1) * pagination.size + index + 1 }}</td>
                    <td>{{ menu.menuName }}</td>
                    <td>{{ menu.menuCode }}</td>
                    <td>{{ menu.path || '-' }}</td>
                    <td>
                        <span class="type-badge" :class="getTypeClass(menu.menuType)">
                            {{ getTypeText(menu.menuType) }}
                        </span>
                    </td>
                    <td>{{ menu.sort }}</td>
                    <td>{{ formatDateTime(menu.createTime) }}</td>
                    <td>{{ formatDateTime(menu.updateTime) }}</td>
                    <td class="actions">
                        <button class="action-btn btn-edit" @click="openEditModal(menu)">
                            <span>âœï¸</span>
                            ç¼–è¾‘
                        </button>
                        <button class="action-btn btn-delete" @click="handleDelete(menu)">
                            <span>ğŸ—‘ï¸</span>
                            åˆ é™¤
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- åˆ†é¡µ -->
    <div class="pagination" v-if="menuList.length > 0">
        <button
            class="pagination-btn"
            :disabled="pagination.current === 1"
            @click="handlePageChange(pagination.current - 1)"
        >
            ä¸Šä¸€é¡µ
        </button>
        <span class="pagination-info">
            ç¬¬ {{ pagination.current }} / {{ pagination.pages }} é¡µ
            <span class="pagination-total">å…± {{ pagination.total }} æ¡è®°å½•</span>
        </span>
        <button
            class="pagination-btn"
            :disabled="pagination.current >= pagination.pages"
            @click="handlePageChange(pagination.current + 1)"
        >
            ä¸‹ä¸€é¡µ
        </button>
    </div>

    <!-- èœå•ç¼–è¾‘å¼¹çª— -->
    <div class="modal-overlay" v-show="showMenuModal" style="display: none;" @click.self="closeMenuModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>{{ menuModalMode === 'add' ? 'æ–°å¢èœå•' : 'ç¼–è¾‘èœå•' }}</h2>
                <button class="modal-close" @click="closeMenuModal">âœ•</button>
            </div>
            <div class="modal-body">
                <form @submit.prevent="handleMenuSubmit">
                    <div class="form-group">
                        <label class="form-label">çˆ¶èœå•</label>
                        <select v-model="menuForm.parentId" class="form-input">
                            <option value="0">é¡¶çº§èœå•</option>
                            <option v-for="parent in parentMenus" :key="parent.id" :value="parent.id">
                                {{ parent.menuName }}
                            </option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">èœå•åç§° <span class="required">*</span></label>
                        <input
                            v-model="menuForm.menuName"
                            type="text"
                            class="form-input"
                            placeholder="è¯·è¾“å…¥èœå•åç§°"
                        >
                    </div>
                    <div class="form-group">
                        <label class="form-label">èœå•ç¼–ç  <span class="required">*</span></label>
                        <input
                            v-model="menuForm.menuCode"
                            type="text"
                            class="form-input"
                            placeholder="è¯·è¾“å…¥èœå•ç¼–ç "
                        >
                    </div>
                    <div class="form-group">
                        <label class="form-label">èœå•è·¯å¾„</label>
                        <input
                            v-model="menuForm.path"
                            type="text"
                            class="form-input"
                            placeholder="è¯·è¾“å…¥èœå•è·¯å¾„"
                        >
                    </div>
                    <div class="form-group">
                        <label class="form-label">èœå•ç±»å‹ <span class="required">*</span></label>
                        <select v-model="menuForm.menuType" class="form-input">
                            <option value="D">ç›®å½•</option>
                            <option value="M">èœå•</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">æ’åº</label>
                        <input
                            v-model.number="menuForm.sort"
                            type="number"
                            class="form-input"
                            placeholder="è¯·è¾“å…¥æ’åºå·"
                            min="0"
                        >
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" @click="closeMenuModal">
                            å–æ¶ˆ
                        </button>
                        <button type="submit" class="btn btn-primary">
                            ç¡®å®š
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="/ems/modules/menu/menu.js"></script>
